<!doctype html>
<meta charset="utf-8">
<title>chao.js</title>
<head>
	<style type="text/css">
		body {
			margin: 0;
			background-color: #202020
		}
	</style>
</head>
<body>
<script src="chao.js"></script>
<script>

	chao.init(640, 480);
	chao.backgroundColor = "#ffffff";
	chao.loadImage("sticker", "sticker.png");
	chao.loadImage("zbylut", "zbylut.png");

	function ComponentLudzik(){
		this.name 				= "Ludzik";

		this.create = function(){
			this.image = this.entity.addComponent(new ComponentImage("zbylut", 30, 30));

			this.image.addAnim("idle_n", [4], 0, false);
			this.image.addAnim("idle_s", [0], 0, false);
			this.image.addAnim("idle_w", [8], 0, false);
			this.image.addAnim("idle_nw", [16], 0, false);
			this.image.addAnim("idle_sw", [12], 0, false);

			this.image.addAnim("run_n", [5, 4, 6, 4], 0.2, true);
			this.image.addAnim("run_s", [1, 0, 2, 0], 0.2, true);
			this.image.addAnim("run_w", [9, 8], 0.2, true);
			this.image.addAnim("run_nw", [17, 16, 18, 16], 0.2, true);
			this.image.addAnim("run_sw", [13, 12, 14, 12], 0.2, true);

			this.image.playAnim("idle_s");
		}

		this.update = function(){
			var direction 	= "";
			var animName 	= "idle";

			if(chao.keys[chao.KEY_UP]){
				direction += "n";
			}else if(chao.keys[chao.KEY_DOWN]){
				direction += "s";
			}
			
			if(chao.keys[chao.KEY_LEFT]){
				direction += "w";
			}else if(chao.keys[chao.KEY_RIGHT]){
				direction += "e";
			}

			if(direction.length > 0){
				switch(direction){
					case "n" : 
						animName 			= "run_n";
						this.image.flipX 	= false;
						break;
					case "s" : 
						animName 			= "run_s";
						this.image.flipX 	= false;
						break;
					case "w" : 
						animName 			= "run_w";
						this.image.flipX 	= false;
						break;
					case "e" : 
						animName 			= "run_w";
						this.image.flipX 	= true;
						break;
					case "nw" : 
						animName 			= "run_nw";
						this.image.flipX 	= false;
						break;
					case "ne" : 
						animName 			= "run_nw";
						this.image.flipX 	= true;
						break;
					case "sw" : 
						animName 			= "run_sw";
						this.image.flipX 	= false;
						break;
					case "se" : 
						animName 			= "run_sw";
						this.image.flipX 	= true;
				}
			}

			if(animName === "idle"){
				animName = this.image.getCurrentAnim().key;

				var dashPos = animName.indexOf("_");
				animName = "idle" + animName.substr(dashPos);
			}

			this.image.playAnim(animName, false);

			var currSpeed = chao.getTimeDelta() * 80;
			if(direction.indexOf("n") != -1){
				this.entity.y -= currSpeed;
			}
			if(direction.indexOf("s") != -1){
				this.entity.y += currSpeed;
			}
			if(direction.indexOf("w") != -1){
				this.entity.x -= currSpeed;
			}
			if(direction.indexOf("e") != -1){
				this.entity.x += currSpeed;
			}

		}

	}

	var StateGame = {

		bounceTimer: 0.0,

		create: function(){
			this.thingie = new Entity("Thingie", 100, 100);
			this.thingie.addComponent(new ComponentImage("sticker"));
			this.thingie.clickable = true;
			this.add(this.thingie);

			var zbylut = new Entity("Zbylut", 400, 100);
			zbylut.addComponent(new ComponentLudzik());
			zbylut.scaleX = 2;
			zbylut.scaleY = 2;
			zbylut.clickable = true;
			this.add(zbylut);
		},

		update: function(){
			this.bounceTimer += chao.getTimeDelta() * 3;
			this.thingie.y = 100 + Math.sin(this.bounceTimer) * 20;

			this.thingie.rotation 	= Math.cos(this.bounceTimer) * 20;
			this.thingie.scaleX 	= (0.8 + (Math.sin(this.bounceTimer) * 0.2));
			this.thingie.scaleY 	= (0.8 + (Math.cos(this.bounceTimer) * 0.2));

			if(chao.mouse.justPressed){
				var clickedEntity = this.rootObject.getEntityAt(chao.mouse.x, chao.mouse.y);
				if(clickedEntity != null){
					chao.log("Clicked on " + clickedEntity.name + "!");
				}
			}

		}
	};
	
	chao.switchState(StateGame);



</script>
</body>