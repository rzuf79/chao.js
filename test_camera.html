<!doctype html>
<meta charset="utf-8">
<title>chao.js</title>
<head>
	<style type="text/css">
		body {
			margin: 0;
			background-color: #202020
		}
	</style>
</head>
<body>
	<center>
<script src="chao.js"></script>
<script>

	chao.init(640, 480, chao.SCALING_MODE_KEEP_RATIO);
	chao.backgroundColor = "#ffffff";

	chao.loadImage("buba", "assets/buba.png");
	chao.loadImage("cloud", "assets/cloud.png");
	chao.loadImage("island_large", "assets/island_large.png");
	chao.loadImage("island_small1", "assets/island_small1.png");
	chao.loadImage("island_small2", "assets/island_small2.png");

	function ComponentLudzik(){
		this.name 				= "Buba";

		this.create = function(){
			this.image = this.entity.addComponent(new ComponentImage("buba", 64, 64));

			this.image.addAnim("idle", [0], 0, false);
			this.image.addAnim("run", [1, 0, 2, 0], 0.2, true);
			this.image.playAnim("idle");
		}

		this.update = function(){
			var direction 	= "";
			var animName 	= "idle";

			if(chao.keys[chao.KEY_UP]){
				direction += "n";
			}else if(chao.keys[chao.KEY_DOWN]){
				direction += "s";
			}
			if(chao.keys[chao.KEY_LEFT]){
				direction += "w";
			}else if(chao.keys[chao.KEY_RIGHT]){
				direction += "e";
			}

			if(direction.length > 0){
				animName = "run";
			}

			this.image.playAnim(animName, false);

			var currSpeed = chao.getTimeDelta() * 80;
			if(direction.indexOf("n") != -1){
				this.entity.y -= currSpeed;
			}
			if(direction.indexOf("s") != -1){
				this.entity.y += currSpeed;
			}
			if(direction.indexOf("w") != -1){
				this.entity.x -= currSpeed;
				this.image.flipX = true;
			}
			if(direction.indexOf("e") != -1){
				this.entity.x += currSpeed;
				this.image.flipX = false;
			}

		}

	}

	var StateGame = {

		create: function(){

			chao.countFPS = true;

			this.camera = (new Entity("Camera")).addComponent(new ComponentCamera());
			this.add(this.camera.entity);

			this.camera.entity.add(chao.helpers.createImage("Small Island", "island_small1", -64, -64).entity);

			this.camera.entity.add(chao.helpers.createImage("Island", "island_large", 200, 200).entity);

			this.ludzik = (new Entity("Buba", 400, 400)).addComponent(new ComponentLudzik());
			this.camera.entity.add(this.ludzik.entity);

			this.camera.follow(this.ludzik.entity, chao.framerate);
			this.camera.bounds = {x:100, y:100, width:750, height:700};
			this.camera.deadzone = {	x: chao.screenWidth/2-50,
								y: chao.screenHeight/2-50,
								width: 100,
								height: 100};


			this.textLogo = chao.helpers.createText("Logo", 10, 20, chao.font, "darknye√ü", 35);
			this.add(this.textLogo.entity);
			this.textLogo.entity.alignToParentHorizontally();
			chao.addTween(this.textLogo.entity, "rotation", -20, 20, 0.7, 
				chao.INTERPOLATE_SMOOTH, chao.REPEAT_MODE_BOUNCE, 0);


			var debugInfo = chao.helpers.createText("Debug Info", 0, 0, chao.font, 
				"[F] stick camera to the ludzik\n[U] unstick camera\n[SPACE] slide camera to the mysterious island of wonders\n[L] log hierarchy",
				20);
			this.add(debugInfo.entity);
			debugInfo.entity.alignToParent(0.0, 1.0, 0.0, 1.0);
			chao.log(debugInfo.entity);

			chao.helpers.fadeEntityIn(this.rootEntity, 5.0);
		},

		update: function(){
			if(chao.justPressed[chao.KEY_L]){
				chao.logHierarchy();
			}
			if(chao.justPressed[chao.KEY_F]){
				this.camera.follow(this.ludzik.entity);
			}
			if(chao.justPressed[chao.KEY_U]){
				this.camera.unfollow();
			}
			if(chao.justPressed[chao.KEY_SPACE]){
				// chao.finishAllTweens(true);
				this.camera.slideToPosition(0, 0, 1);
			}

			this.ludzik.entity.x = chao.clamp(this.ludzik.entity.x, 214, 610);
			this.ludzik.entity.y = chao.clamp(this.ludzik.entity.y, 220, 550);
		},

		draw: function(){
			// // debuggy camera deadzone display
			// chao.drawRect(chao.canvas, 
			// 	this.camera.deadzone.x, this.camera.deadzone.y, 
			// 	this.camera.deadzone.width, this.camera.deadzone.height,
			// 	chao.colorCodes[2], 2);
		}


	};
	
	chao.switchState(StateGame);



</script>
</body>